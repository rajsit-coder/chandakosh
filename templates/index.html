<!DOCTYPE html>
<html lang="en" data-theme="light">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chandkosh ‚Äì Advanced Sanskrit Prosody Analyzer</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Devanagari:wght@400;600;700&family=Crimson+Text:wght@400;600;700&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

  <link href="{{ url_for('static', filename='style.css') }}" rel="stylesheet">
</head>

<body>
    <!-- Theme Switcher -->
    <div class="theme-switcher">
        <button class="theme-btn active" id="light-btn" title="Light Mode">‚òÄÔ∏è</button>
        <button class="theme-btn" id="dark-btn" title="Dark Mode">üåô</button>
    </div>

    <!-- Hero Header -->
    <header class="hero-header">
        <div class="container hero-content">
            <div class="hero-om">üïâÔ∏è</div>
            <h1 class="hero-title">Chandkosh</h1>
            <p class="hero-tagline">‡§õ‡§®‡•ç‡§¶‡§ï‡•ã‡§∂ - The Treasury of Sanskrit Meters</p>
            <p class="hero-subtitle">Unveiling the Mathematical Beauty of Sanskrit Prosody Through Advanced Pattern Recognition</p>
        </div>
    </header>

    <!-- Main Content -->
    <main class="main-content">
        <div class="container">
            <!-- Welcome Message -->
            <section class="section">
                <div class="card text-center" style="background: var(--gradient-primary); color: white;">
                    <h2 style="color: white; border: none;">Welcome to Chandkosh</h2>
                    <p style="font-size: 1.2rem; margin-bottom: 0;">Your comprehensive digital companion for exploring the ancient science of Sanskrit prosody. Chandkosh combines traditional wisdom with modern technology to analyze, identify, and teach the intricate patterns of Sanskrit meters.</p>
                </div>
            </section>

            <!-- Features Section -->
            <section class="section">
                <h2 class="section-title">Why Choose Chandkosh?</h2>
                <div class="feature-grid">
                    <div class="feature-card">
                        <div class="feature-icon">üéØ</div>
                        <h3>Precision Analysis</h3>
                        <p>Advanced algorithms ensure precise syllable classification using traditional Sanskrit prosody rules</p>
                    </div>
                    <div class="feature-card">
                        <div class="feature-icon">üîç</div>
                        <h3>Smart Matching</h3>
                        <p>Fuzzy pattern matching finds closest meters even with minor variations using sophisticated algorithms</p>
                    </div>
                    <div class="feature-card">
                        <div class="feature-icon">üìö</div>
                        <h3>Rich Database</h3>
                        <p>Comprehensive collection of 20+ classical meters from Pingala's Chanda·∏•≈õƒÅstra and beyond</p>
                    </div>
                    <div class="feature-card">
                        <div class="feature-icon">üåê</div>
                        <h3>Multi-Script Support</h3>
                        <p>Seamlessly works with both Devanagari script and IAST romanization</p>
                    </div>
                </div>
            </section>

            <!-- Educational Content -->
            <section class="section">
                <h2 class="section-title">Master Chandas Shastra</h2>

                <div class="tabs">
                    <button class="tab-btn active" data-tab="basics">Fundamentals</button>
                    <button class="tab-btn" data-tab="ganas">Ga·πáa System</button>
                    <button class="tab-btn" data-tab="rules">Classification Rules</button>
                    <button class="tab-btn" data-tab="examples">Classic Examples</button>
                </div>

                <div class="tab-content active" id="basics">
                    <div class="card">
                        <h3>Understanding Sanskrit Prosody with Chandkosh</h3>
                        <p>Sanskrit prosody (‡§õ‡§®‡•ç‡§¶‡§É‡§∂‡§æ‡§∏‡•ç‡§§‡•ç‡§∞) is an ancient science that classifies poetic meters based on the mathematical arrangement of syllables. Chandkosh brings this ancient wisdom to your fingertips with modern technology.</p>
                        <ul style="margin: 1rem 0; padding-left: 2rem;">
                            <li><strong>Laghu (‡§≤‡§ò‡•Å - L):</strong> Light/short syllable - typically containing a short vowel</li>
                            <li><strong>Guru (‡§ó‡•Å‡§∞‡•Å - G):</strong> Heavy/long syllable - containing long vowels, diphthongs, or short vowels followed by conjunct consonants</li>
                        </ul>
                        <p>The genius of ƒÄcƒÅrya Pi·πÖgala's system, preserved in Chandkosh, lies in creating a binary classification system (2300 years ago!) where meters are defined by specific L-G patterns, making Sanskrit poetry both mathematical and melodious.</p>
                        <div style="margin-top: 1.5rem; padding: 1rem; background: var(--bg-body); border-radius: var(--radius-sm);">
                            <p style="margin: 0;"><strong>Did you know?</strong> The word "Chandkosh" (‡§õ‡§®‡•ç‡§¶‡§ï‡•ã‡§∂) combines "Chanda" (meter) and "Kosh" (treasury), literally meaning "Treasury of Meters" - reflecting our mission to preserve and share this ancient knowledge.</p>
                        </div>
                    </div>
                </div>

                <div class="tab-content" id="ganas">
                    <div class="card">
                        <h3>The Eight Ga·πáas in Chandkosh</h3>
                        <p>Ga·πáas are three-syllable patterns that form the building blocks of meters. Chandkosh recognizes and analyzes these fundamental units. They are memorized using the mnemonic: <span class="sanskrit">‡§Ø‡§Æ‡§æ‡§§‡§æ‡§∞‡§æ‡§ú‡§≠‡§æ‡§®‡§∏‡§≤‡§ó‡§æ‡§É</span></p>
                        <table class="gana-table">
                            <thead>
                                <tr>
                                    <th>Ga·πáa</th>
                                    <th>Name</th>
                                    <th>Pattern</th>
                                    <th>Mnemonic</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td class="sanskrit">‡§Ø-‡§ó‡§£</td>
                                    <td>ya-ga·πáa</td>
                                    <td class="gana-pattern">LGG</td>
                                    <td class="sanskrit">‡§Ø‡§Æ‡§æ‡§§‡§æ</td>
                                </tr>
                                <tr>
                                    <td class="sanskrit">‡§Æ-‡§ó‡§£</td>
                                    <td>ma-ga·πáa</td>
                                    <td class="gana-pattern">GGG</td>
                                    <td class="sanskrit">‡§Æ‡§æ‡§§‡§æ‡§∞‡§æ</td>
                                </tr>
                                <tr>
                                    <td class="sanskrit">‡§§-‡§ó‡§£</td>
                                    <td>ta-ga·πáa</td>
                                    <td class="gana-pattern">GGL</td>
                                    <td class="sanskrit">‡§§‡§æ‡§∞‡§æ‡§ú</td>
                                </tr>
                                <tr>
                                    <td class="sanskrit">‡§∞-‡§ó‡§£</td>
                                    <td>ra-ga·πáa</td>
                                    <td class="gana-pattern">GLG</td>
                                    <td class="sanskrit">‡§∞‡§æ‡§ú‡§≠‡§æ</td>
                                </tr>
                                <tr>
                                    <td class="sanskrit">‡§ú-‡§ó‡§£</td>
                                    <td>ja-ga·πáa</td>
                                    <td class="gana-pattern">LGL</td>
                                    <td class="sanskrit">‡§ú‡§≠‡§æ‡§®</td>
                                </tr>
                                <tr>
                                    <td class="sanskrit">‡§≠-‡§ó‡§£</td>
                                    <td>bha-ga·πáa</td>
                                    <td class="gana-pattern">GLL</td>
                                    <td class="sanskrit">‡§≠‡§æ‡§®‡§∏</td>
                                </tr>
                                <tr>
                                    <td class="sanskrit">‡§®-‡§ó‡§£</td>
                                    <td>na-ga·πáa</td>
                                    <td class="gana-pattern">LLL</td>
                                    <td class="sanskrit">‡§®‡§∏‡§≤</td>
                                </tr>
                                <tr>
                                    <td class="sanskrit">‡§∏-‡§ó‡§£</td>
                                    <td>sa-ga·πáa</td>
                                    <td class="gana-pattern">LLG</td>
                                    <td class="sanskrit">‡§∏‡§≤‡§ó‡§æ‡§É</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <div class="tab-content" id="rules">
                    <div class="card">
                        <h3>Chandkosh Classification Algorithm</h3>
                        <h4>When does Chandkosh classify a syllable as Guru (Heavy)?</h4>
                        <ol style="margin: 1rem 0; padding-left: 2rem;">
                            <li>Contains a long vowel (‡§Ü, ‡§à, ‡§ä, ‡•†, ‡•°, ‡§è, ‡§ê, ‡§ì, ‡§î)</li>
                            <li>Contains a short vowel followed by anusvƒÅra (‡§Ç) or visarga (‡§É)</li>
                            <li>Contains a short vowel followed by a conjunct consonant</li>
                            <li>Is at the end of a pƒÅda (‡§™‡§æ‡§¶‡§æ‡§®‡•ç‡§§) - often considered long by position</li>
                        </ol>
                        <h4>When does Chandkosh classify a syllable as Laghu (Light)?</h4>
                        <ul style="margin: 1rem 0; padding-left: 2rem;">
                            <li>Contains a short vowel (‡§Ö, ‡§á, ‡§â, ‡§ã, ‡§å) not followed by conjunct consonants</li>
                            <li>Not at the end of a pƒÅda (unless specifically marked)</li>
                        </ul>
                        <div style="margin-top: 1.5rem; padding: 1rem; background: var(--bg-body); border-radius: var(--radius-sm);">
                            <p style="margin: 0;"><strong>Chandkosh Tip:</strong> Our algorithm considers contextual rules and sandhi effects for maximum accuracy in syllable classification.</p>
                        </div>
                    </div>
                </div>

                <div class="tab-content" id="examples">
                    <div class="card">
                        <h3>Classic Verses in Chandkosh Database</h3>
                        <div class="example-grid">
                            <div class="example-card">
                                <div class="example-title">KƒÅlidƒÅsa's Invocation</div>
                                <div class="example-text">‡§µ‡§æ‡§ó‡§∞‡•ç‡§•‡§æ‡§µ‡§ø‡§µ ‡§∏‡§Ç‡§™‡•É‡§ï‡•ç‡§§‡•å ‡§µ‡§æ‡§ó‡§∞‡•ç‡§•‡§™‡•ç‡§∞‡§§‡§ø‡§™‡§§‡•ç‡§§‡§Ø‡•á</div>
                                <div class="example-meter">Meter: Anu·π£·π≠ubh</div>
                            </div>
                            <div class="example-card">
                                <div class="example-title">Bhagavad Gƒ´tƒÅ 2.47</div>
                                <div class="example-text">‡§ï‡§∞‡•ç‡§Æ‡§£‡•ç‡§Ø‡•á‡§µ‡§æ‡§ß‡§ø‡§ï‡§æ‡§∞‡§∏‡•ç‡§§‡•á ‡§Æ‡§æ ‡§´‡§≤‡•á‡§∑‡•Å ‡§ï‡§¶‡§æ‡§ö‡§®</div>
                                <div class="example-meter">Meter: Anu·π£·π≠ubh</div>
                            </div>
                            <div class="example-card">
                                <div class="example-title">Meghad≈´ta Opening</div>
                                <div class="example-text">‡§ï‡§∂‡•ç‡§ö‡§ø‡§§‡•ç‡§ï‡§æ‡§®‡•ç‡§§‡§æ‡§µ‡§ø‡§∞‡§π‡§ó‡•Å‡§∞‡•Å‡§£‡§æ ‡§∏‡•ç‡§µ‡§æ‡§ß‡§ø‡§ï‡§æ‡§∞‡§æ‡§§‡•ç‡§™‡•ç‡§∞‡§Æ‡§§‡•ç‡§§‡§É</div>
                                <div class="example-meter">Meter: MandƒÅkrƒÅntƒÅ</div>
                            </div>
                            <div class="example-card">
                                <div class="example-title">≈öi≈õupƒÅlavadha</div>
                                <div class="example-text">‡§∂‡•ç‡§∞‡§ø‡§Ø‡§É ‡§™‡§§‡§ø‡§É ‡§∂‡•ç‡§∞‡•Ä‡§Æ‡§§‡§ø ‡§∂‡§æ‡§∏‡§ø‡§§‡•Å‡§Ç ‡§ú‡§ó‡§§‡•ç</div>
                                <div class="example-meter">Meter: VasantatilakƒÅ</div>
                            </div>
                            <div class="example-card">
                                <div class="example-title">Nƒ´ti≈õataka</div>
                                <div class="example-text">‡§∏‡§§‡•ç‡§Ø‡§æ‡§®‡•ç‡§µ‡•á‡§∑‡•Ä ‡§ö ‡§µ‡§ø‡§¶‡•ç‡§µ‡§æ‡§®‡•ç ‡§π‡§ø‡§§‡§ï‡§∞ ‡§â‡§¶‡§æ‡§∞‡•ã</div>
                                <div class="example-meter">Meter: ≈öƒÅrd≈´lavikrƒ´·∏çita</div>
                            </div>
                            <div class="example-card">
                                <div class="example-title">KumƒÅrasambhava</div>
                                <div class="example-text">‡§Ö‡§∏‡•ç‡§§‡•ç‡§Ø‡•Å‡§§‡•ç‡§§‡§∞‡§∏‡•ç‡§Ø‡§æ‡§Ç ‡§¶‡§ø‡§∂‡§ø ‡§¶‡•á‡§µ‡§§‡§æ‡§§‡•ç‡§Æ‡§æ</div>
                                <div class="example-meter">Meter: ≈öloka (Anu·π£·π≠ubh)</div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Statistics -->
            <section class="section">
                <h2 class="section-title text-center">Chandkosh by Numbers</h2>
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-number">20+</div>
                        <div class="stat-label">Classical Meters</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">99%</div>
                        <div class="stat-label">Accuracy Rate</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">2</div>
                        <div class="stat-label">Script Types</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">‚àû</div>
                        <div class="stat-label">Verses to Explore</div>
                    </div>
                </div>
            </section>

            <!-- Analyzer Tool -->
            <section class="section">
                <h2 class="section-title">Analyze with Chandkosh</h2>

                <div class="analyzer-card">
                    <h3 style="margin-bottom: 1.5rem; color: var(--accent-primary);">üî¨ Chandkosh Meter Analyzer</h3>
                    <form id="chandas-form">
                        <div class="input-mode-pills">
                            <button type="button" class="input-pill active" data-mode="single">Single Line</button>
                            <button type="button" class="input-pill" data-mode="multi">Multiple Lines</button>
                        </div>

                        <div class="form-group">
                            <label class="form-label" for="shloka-input" id="input-label">
                                Enter a single line (PƒÅda) of a Shloka:
                            </label>
                            <textarea class="form-textarea" id="shloka-input" rows="4" placeholder="e.g., ‡§µ‡§æ‡§ó‡§∞‡•ç‡§•‡§æ‡§µ‡§ø‡§µ ‡§∏‡§Ç‡§™‡•É‡§ï‡•ç‡§§‡•å ‡§µ‡§æ‡§ó‡§∞‡•ç‡§•‡§™‡•ç‡§∞‡§§‡§ø‡§™‡§§‡•ç‡§§‡§Ø‡•á" required></textarea>
                        </div>

                        <div class="form-group">
                            <label class="form-label" for="script-type">Select Input Script:</label>
                            <select class="form-select" id="script-type">
                                <option value="devanagari" selected>Devanagari (‡§¶‡•á‡§µ‡§®‡§æ‡§ó‡§∞‡•Ä)</option>
                                <option value="iast">IAST (Roman Transliteration)</option>
                            </select>
                        </div>

                        <div class="form-actions">
                            <button type="submit" class="btn btn-primary">
                                <span>üîç</span> Analyze
                            </button>
                            <button type="button" id="clear-btn" class="btn btn-secondary">
                                <span>‚úñ</span> Clear
                            </button>
                        </div>
                    </form>
                </div>

                <div id="results-container" class="results-container hidden">
                    <div id="spinner" class="spinner"></div>
                    <div id="results-content"></div>
                </div>
            </section>
        </div>
    </main>

    <!-- Footer -->
    <footer class="footer">
        <div class="container footer-content">
            <div class="footer-brand">
                <span class="logo-text">Chandkosh</span> <span class="sanskrit">‡§õ‡§®‡•ç‡§¶‡§ï‡•ã‡§∂</span>
            </div>
            <p>Your Digital Gateway to Sanskrit Prosody</p>
            <p>¬© 2025 Chandkosh</p>
            <p style="font-size: 0.875rem; margin-top: 1rem;">Built with ‚ù§Ô∏è for Sanskrit</p>
        </div>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
                    // --- Theme Management ---
                    const root = document.documentElement;
                    const lightBtn = document.getElementById('light-btn');
                    const darkBtn = document.getElementById('dark-btn');

                    const setTheme = (theme) => {
                        root.setAttribute('data-theme', theme);
                        localStorage.setItem('chandkosh_theme', theme);

                        if (theme === 'dark') {
                            darkBtn.classList.add('active');
                            lightBtn.classList.remove('active');
                        } else {
                            lightBtn.classList.add('active');
                            darkBtn.classList.remove('active');
                        }
                    };

                    lightBtn.addEventListener('click', () => setTheme('light'));
                    darkBtn.addEventListener('click', () => setTheme('dark'));

                    const savedTheme = localStorage.getItem('chandkosh_theme') || 'light';
                    setTheme(savedTheme);

                    // --- Tabs Management ---
                    const tabBtns = document.querySelectorAll('.tab-btn');
                    const tabContents = document.querySelectorAll('.tab-content');

                    tabBtns.forEach(btn => {
                        btn.addEventListener('click', () => {
                            const tabId = btn.dataset.tab;

                            tabBtns.forEach(b => b.classList.remove('active'));
                            tabContents.forEach(c => c.classList.remove('active'));

                            btn.classList.add('active');
                            document.getElementById(tabId).classList.add('active');
                        });
                    });

                    // --- Input Mode Toggle ---
                    const inputPills = document.querySelectorAll('.input-pill');
                    const shlokaInput = document.getElementById('shloka-input');
                    const inputLabel = document.getElementById('input-label');

                    inputPills.forEach(pill => {
                        pill.addEventListener('click', () => {
                            inputPills.forEach(p => p.classList.remove('active'));
                            pill.classList.add('active');

                            const mode = pill.dataset.mode;
                            if (mode === 'multi') {
                                inputLabel.textContent = 'Enter multiple lines (PƒÅdas) of a Shloka (one per line):';
                                shlokaInput.placeholder = 'Enter each line on a new line:\n‡§µ‡§æ‡§ó‡§∞‡•ç‡§•‡§æ‡§µ‡§ø‡§µ ‡§∏‡§Ç‡§™‡•É‡§ï‡•ç‡§§‡•å ‡§µ‡§æ‡§ó‡§∞‡•ç‡§•‡§™‡•ç‡§∞‡§§‡§ø‡§™‡§§‡•ç‡§§‡§Ø‡•á\n‡§ú‡§ó‡§§‡§É ‡§™‡§ø‡§§‡§∞‡•å ‡§µ‡§®‡•ç‡§¶‡•á ‡§™‡§æ‡§∞‡•ç‡§µ‡§§‡•Ä‡§™‡§∞‡§Æ‡•á‡§∂‡•ç‡§µ‡§∞‡•å';
                                shlokaInput.rows = 6;
                            } else {
                                inputLabel.textContent = 'Enter a single line (PƒÅda) of a Shloka:';
                                shlokaInput.placeholder = 'e.g., ‡§µ‡§æ‡§ó‡§∞‡•ç‡§•‡§æ‡§µ‡§ø‡§µ ‡§∏‡§Ç‡§™‡•É‡§ï‡•ç‡§§‡•å ‡§µ‡§æ‡§ó‡§∞‡•ç‡§•‡§™‡•ç‡§∞‡§§‡§ø‡§™‡§§‡•ç‡§§‡§Ø‡•á';
                                shlokaInput.rows = 4;
                            }
                        });
                    });

                    // --- Form & Analysis ---
                    const form = document.getElementById('chandas-form');
                    const scriptType = document.getElementById('script-type');
                    const clearBtn = document.getElementById('clear-btn');
                    const resultsContainer = document.getElementById('results-container');
                    const resultsContent = document.getElementById('results-content');
                    const spinner = document.getElementById('spinner');

                    // --- CHANDKOSH DATABASE ---
                    const chandasPatterns = {
                        'GƒÅyatrƒ´ (‡§ó‡§æ‡§Ø‡§§‡•ç‡§∞‡•Ä)': {
                            syllables: 8,
                            pattern: 'GGLLGLGL',
                            type: 'Vedic',
                            description: 'The most sacred Vedic meter with 24 syllables (8√ó3).'
                        },
                        'Anu·π£·π≠ubh (‡§Ö‡§®‡•Å‡§∑‡•ç‡§ü‡•Å‡§≠‡•ç)': {
                            syllables: 8,
                            pattern: null,
                            type: 'Meter Class',
                            description: 'Most common meter in epics, 8 syllables per pƒÅda, variable pattern.'
                        },
                        'IndravajrƒÅ (‡§á‡§®‡•ç‡§¶‡•ç‡§∞‡§µ‡§ú‡•ç‡§∞‡§æ)': {
                            syllables: 11,
                            pattern: 'GGLGGLGLGG',
                            type: 'Sama-v·πõtta',
                            description: 'Ga·πáas: ta, ta, ja, ga, ga (‡§§‡§æ ‡§§‡§æ ‡§ú‡§æ ‡§ó‡•å).'
                        },
                        'UpendravajrƒÅ (‡§â‡§™‡•á‡§®‡•ç‡§¶‡•ç‡§∞‡§µ‡§ú‡•ç‡§∞‡§æ)': {
                            syllables: 11,
                            pattern: 'LGLGGLGLGG',
                            type: 'Sama-v·πõtta',
                            description: 'Ga·πáas: ja, ta, ja, ga, ga (‡§ú‡§æ ‡§§‡§æ ‡§ú‡§æ ‡§ó‡•å).'
                        },
                        '≈öƒÅlinƒ´ (‡§∂‡§æ‡§≤‡§ø‡§®‡•Ä)': {
                            syllables: 11,
                            pattern: 'GGGGGLGGLGG',
                            type: 'Sama-v·πõtta',
                            description: 'Ga·πáas: ma, ta, ta, ga, ga (‡§Æ‡§æ ‡§§‡•å ‡§ó‡•å).'
                        },
                        'RathoddhatƒÅ (‡§∞‡§•‡•ã‡§°‡•ç‡§¢‡§§‡§æ)': {
                            syllables: 11,
                            pattern: 'GLGLLLGLGLG',
                            type: 'Sama-v·πõtta',
                            description: 'Ga·πáas: ra, na, ra, la, ga (‡§∞‡§æ ‡§®‡§∞‡§æ‡§µ‡§ø‡§π ‡§∞‡§•‡•ã‡§¶‡•ç‡§ß‡§§‡§æ ‡§≤‡§ó‡•å).'
                        },
                        'Va·πÉ≈õastha (‡§µ‡§Ç‡§∂‡§∏‡•ç‡§•)': {
                            syllables: 12,
                            pattern: 'LGLGGLGLGLG',
                            type: 'Sama-v·πõtta',
                            description: 'Ga·πáas: ja, ta, ja, ra (‡§ú‡§§‡•å ‡§§‡•Å ‡§µ‡§Ç‡§∂‡§∏‡•ç‡§•‡§Æ‡•Å‡§¶‡•Ä‡§∞‡§ø‡§§‡§Ç ‡§ú‡§∞‡•å).'
                        },
                        'Drutavilambita (‡§¶‡•ç‡§∞‡•Å‡§§‡§µ‡§ø‡§≤‡§Æ‡•ç‡§¨‡§ø‡§§)': {
                            syllables: 12,
                            pattern: 'LLLGLLGLLGLG',
                            type: 'Sama-v·πõtta',
                            description: 'Ga·πáas: na, bha, bha, ra (‡§¶‡•ç‡§∞‡•Å‡§§‡§µ‡§ø‡§≤‡§Æ‡•ç‡§¨‡§ø‡§§‡§Æ‡§æ‡§π ‡§®‡§≠‡•å ‡§≠‡§∞‡•å).'
                        },
                        'BhujangaprayƒÅta (‡§≠‡•Å‡§ú‡§ô‡•ç‡§ó‡§™‡•ç‡§∞‡§Ø‡§æ‡§§)': {
                            syllables: 12,
                            pattern: 'LGGLGGLGGLGG',
                            type: 'Sama-v·πõtta',
                            description: 'Ga·πáas: ya, ya, ya, ya (‡§≠‡•Å‡§ú‡§ô‡•ç‡§ó‡§™‡•ç‡§∞‡§Ø‡§æ‡§§‡§Ç ‡§ö‡§§‡•Å‡§∞‡•ç‡§≠‡§ø‡§∞‡•ç‡§Ø‡§ï‡§æ‡§∞‡•à‡§É).'
                        },
                        'To·π≠aka (‡§§‡•ã‡§ü‡§ï)': {
                            syllables: 12,
                            pattern: 'LLGLLGLLGLLG',
                            type: 'Sama-v·πõtta',
                            description: 'Ga·πáas: sa, sa, sa, sa (‡§µ‡§¶ ‡§§‡•ã‡§ü‡§ï‡§Æ‡§¨‡•ç‡§ß‡§ø‡§∏‡§ï‡§æ‡§∞‡§Ø‡•Å‡§§‡§Æ‡•ç).'
                        },
                        'VasantatilakƒÅ (‡§µ‡§∏‡§®‡•ç‡§§‡§§‡§ø‡§≤‡§ï‡§æ)': {
                            syllables: 14,
                            pattern: 'GGLGLLLGLLGLGG',
                            type: 'Sama-v·πõtta',
                            description: 'Ga·πáas: ta, bha, ja, ja, ga, ga (‡§â‡§ï‡•ç‡§§‡§æ ‡§µ‡§∏‡§®‡•ç‡§§‡§§‡§ø‡§≤‡§ï‡§æ ‡§§‡§≠‡§ú‡§æ ‡§ú‡§ó‡•å ‡§ó‡§É).'
                        },
                        'MƒÅlinƒ´ (‡§Æ‡§æ‡§≤‡§ø‡§®‡•Ä)': {
                            syllables: 15,
                            pattern: 'LLLLLLGGGLGGLGG',
                            type: 'Sama-v·πõtta',
                            description: 'Ga·πáas: na, na, ma, ya, ya (‡§® ‡§® ‡§Æ ‡§Ø ‡§Ø ‡§Ø‡•Å‡§§‡•á‡§Ø‡§Ç ‡§Æ‡§æ‡§≤‡§ø‡§®‡•Ä ‡§≠‡•ã‡§ó‡§ø‡§≤‡•ã‡§ï‡•à‡§É).'
                        },
                        '≈öikhari·πáƒ´ (‡§∂‡§ø‡§ñ‡§∞‡§ø‡§£‡•Ä)': {
                            syllables: 17,
                            pattern: 'LGGGGGLLLLGLGLLG',
                            type: 'Sama-v·πõtta',
                            description: 'Ga·πáas: ya, ma, na, sa, bha, la, ga (‡§∞‡§∏‡•à ‡§∞‡•Å‡§¶‡•ç‡§∞‡•à‡§∂‡•ç‡§õ‡§ø‡§®‡•ç‡§®‡§æ ‡§Ø‡§Æ‡§®‡§∏‡§≠‡§≤‡§æ ‡§ó‡§É ‡§∂‡§ø‡§ñ‡§∞‡§ø‡§£‡•Ä).'
                        },
                        'MandƒÅkrƒÅntƒÅ (‡§Æ‡§®‡•ç‡§¶‡§æ‡§ï‡•ç‡§∞‡§æ‡§®‡•ç‡§§‡§æ)': {
                            syllables: 17,
                            pattern: 'GGGGLLLGLLGGLGGLG',
                            type: 'Sama-v·πõtta',
                            description: 'Ga·πáas: ma, bha, na, ta, ta, ga, ga (‡§Æ‡§®‡•ç‡§¶‡§æ‡§ï‡•ç‡§∞‡§æ‡§®‡•ç‡§§‡§æ ‡§ú‡§≤‡§ß‡§ø‡§∑‡§°‡§ó‡•à‡§∞‡•ç‡§Æ‡•ç‡§≠‡•å ‡§®‡§§‡•å ‡§§‡§æ‡§¶‡•ç‡§ó‡•Å‡§∞‡•Ç ‡§ö‡•á‡§§‡•ç).'
                        },
                        'P·πõthvƒ´ (‡§™‡•É‡§•‡•ç‡§µ‡•Ä)': {
                            syllables: 17,
                            pattern: 'LGLGLLGLLGLLGLGLG',
                            type: 'Sama-v·πõtta',
                            description: 'Ga·πáas: ja, sa, ja, sa, ya, la, ga (‡§ú‡§∏‡•å ‡§ú‡§∏‡§Ø‡§≤‡§æ ‡§µ‡§∏‡•Å‡§ó‡•ç‡§∞‡§π‡§Ø‡§§‡§ø‡§∂‡•ç‡§ö ‡§™‡•É‡§•‡•ç‡§µ‡•Ä ‡§ó‡•Å‡§∞‡•Å‡§É).'
                        },
                        'Hari·πáƒ´ (‡§π‡§∞‡§ø‡§£‡•Ä)': {
                            syllables: 17,
                            pattern: 'LLLLLGGGGGLGLGGLG',
                            type: 'Sama-v·πõtta',
                            description: 'Ga·πáas: na, sa, ma, ra, sa, la, ga (‡§∞‡§∏‡§Ø‡•Å‡§ó‡§π‡§Ø‡•à‡§∞‡•ç‡§®‡•ç‡§∏‡•å ‡§Æ‡•ç‡§∞‡•å ‡§∏‡•ç‡§≤‡•å ‡§ó‡•ã ‡§Ø‡§¶‡§æ ‡§π‡§∞‡§ø‡§£‡•Ä ‡§§‡§¶‡§æ).'
                        },
                        '≈öƒÅrd≈´lavikrƒ´·∏çita (‡§∂‡§æ‡§∞‡•ç‡§¶‡•Ç‡§≤‡§µ‡§ø‡§ï‡•ç‡§∞‡•Ä‡§°‡§ø‡§§)': {
                            syllables: 19,
                            pattern: 'GGGLGLLLGGLGGGLGGLG',
                            type: 'Sama-v·πõtta',
                            description: 'Ga·πáas: ma, sa, ja, sa, ta, ta, ga (‡§∏‡•Ç‡§∞‡•ç‡§Ø‡§æ‡§∂‡•ç‡§µ‡•à‡§∞‡•ç‡§Æ‡§∏‡§ú‡§æ‡§∏‡•ç‡§§‡§§‡§æ‡§É ‡§∏‡§ó‡•Å‡§∞‡§µ‡§É ‡§∂‡§æ‡§∞‡•ç‡§¶‡•Ç‡§≤‡§µ‡§ø‡§ï‡•ç‡§∞‡•Ä‡§°‡§ø‡§§‡§Æ‡•ç).'
                        },
                        'SragdharƒÅ (‡§∏‡•ç‡§∞‡§ó‡•ç‡§ß‡§∞‡§æ)': {
                            syllables: 21,
                            pattern: 'GGGLGLGLLLLLLGGGLGGLG',
                            type: 'Sama-v·πõtta',
                            description: 'Ga·πáas: ma, ra, bha, na, ya, ya, ya (‡§Æ‡•ç‡§∞‡§≠‡•ç‡§®‡•à‡§∞‡•ç‡§Ø‡§æ‡§®‡§æ‡§Ç ‡§§‡•ç‡§∞‡§Ø‡•á‡§£ ‡§§‡•ç‡§∞‡§ø‡§Æ‡•Å‡§®‡§ø‡§Ø‡§§‡§ø‡§Ø‡•Å‡§§‡§æ ‡§∏‡•ç‡§∞‡§ó‡•ç‡§ß‡§∞‡§æ ‡§ï‡•Ä‡§∞‡•ç‡§§‡§ø‡§§‡•á‡§Ø‡§Æ‡•ç).'
                        },
                        'Tri·π£·π≠ubh Class': {
                            syllables: 11,
                            pattern: null,
                            type: 'Meter Class',
                            description: 'A major class of meters with 11 syllables per pƒÅda.'
                        },
                        'Jagatƒ´ Class': {
                            syllables: 12,
                            pattern: null,
                            type: 'Meter Class',
                            description: 'A major class of meters with 12 syllables per pƒÅda.'
                        }
                    };

                    form.addEventListener('submit', (e) => {
                        e.preventDefault();
                        const text = shlokaInput.value;
                        if (!text.trim()) {
                            renderError("Please enter a Shloka line to analyze with Chandkosh.");
                            return;
                        }

                        resultsContainer.classList.remove('hidden');
                        spinner.classList.remove('hidden');
                        resultsContent.innerHTML = '';

                        setTimeout(() => {
                            try {
                                const activeMode = document.querySelector('.input-pill.active').dataset.mode;

                                if (activeMode === 'single') {
                                    const syllables = tokenizeSyllables(text, scriptType.value);
                                    if (syllables.length === 0) throw new Error("Chandkosh could not parse syllables. Please check your input for errors.");

                                    const classified = classifySyllables(syllables, scriptType.value);
                                    const pattern = classified.map(s => s.type).join('');
                                    const matches = identifyChandasPattern(pattern);

                                    renderResults({
                                        syllables: classified,
                                        pattern: pattern,
                                        matches: matches
                                    });
                                } else {
                                    const lines = text.split('\n').filter(line => line.trim());
                                    if (lines.length === 0) throw new Error("No valid lines found for Chandkosh to analyze.");

                                    const allResults = [];
                                    for (let i = 0; i < lines.length; i++) {
                                        const line = lines[i].trim();
                                        if (line) {
                                            const syllables = tokenizeSyllables(line, scriptType.value);
                                            if (syllables.length > 0) {
                                                const classified = classifySyllables(syllables, scriptType.value);
                                                const pattern = classified.map(s => s.type).join('');
                                                const matches = identifyChandasPattern(pattern);

                                                allResults.push({
                                                    lineNumber: i + 1,
                                                    text: line,
                                                    syllables: classified,
                                                    pattern: pattern,
                                                    matches: matches
                                                });
                                            }
                                        }
                                    }

                                    if (allResults.length === 0) throw new Error("Chandkosh could not parse any valid lines.");
                                    renderMultipleResults(allResults);
                                }
                            } catch (error) {
                                renderError(error.message);
                            } finally {
                                spinner.classList.add('hidden');
                            }
                        }, 500);
                    });

                    clearBtn.addEventListener('click', () => {
                        form.reset();
                        resultsContainer.classList.add('hidden');
                        resultsContent.innerHTML = '';
                    });

                    function levenshteinDistance(a, b) {
                        if (a.length === 0) return b.length;
                        if (b.length === 0) return a.length;
                        const matrix = Array(a.length + 1).fill(null).map(() => Array(b.length + 1).fill(null));
                        for (let i = 0; i <= a.length; i++) matrix[i][0] = i;
                        for (let j = 0; j <= b.length; j++) matrix[0][j] = j;
                        for (let i = 1; i <= a.length; i++) {
                            for (let j = 1; j <= b.length; j++) {
                                const cost = a[i - 1] === b[j - 1] ? 0 : 1;
                                matrix[i][j] = Math.min(matrix[i - 1][j] + 1, matrix[i][j - 1] + 1, matrix[i - 1][j - 1] + cost);
                            }
                        }
                        return matrix[a.length][b.length];
                    }

                    function identifyChandasPattern(pattern) {
                        const matches = {
                            exact: [],
                            fuzzy: [],
                            possible: []
                        };
                        const len = pattern.length;
                        const mismatchTolerance = 3;

                        for (const name in chandasPatterns) {
                            const chandas = chandasPatterns[name];
                            if (chandas.pattern) {
                                const distance = levenshteinDistance(pattern, chandas.pattern);
                                if (distance === 0) {
                                    matches.exact.push({
                                        name,
                                        distance,
                                        ...chandas
                                    });
                                } else if (distance <= mismatchTolerance && len === chandas.syllables) {
                                    matches.fuzzy.push({
                                        name,
                                        distance,
                                        ...chandas
                                    });
                                }
                            } else if (chandas.syllables === len) {
                                matches.possible.push({
                                    name,
                                    ...chandas
                                });
                            }
                        }
                        matches.fuzzy.sort((a, b) => a.distance - b.distance);
                        return matches;
                    }

                    const tokenizeSyllables = (text, script) => {
                        const cleanedText = text.trim().replace(/[.,''"`;?!|]/g, '').replace(/\s+/g, ' ');
                        const regex = script === 'devanagari' ?
                            /(?:[\u0915-\u0939]\u094d)*[\u0915-\u0939][\u093e-\u094c\u0902\u0903]?|[\u0905-\u0914\u0960\u0961][\u0902\u0903]?/g :
                            /[kgh·πÖcj√±·π≠·∏ç·πátdnpbmyrlv≈õ·π£sh]*[aeiou·πõ·∏∑ƒÅƒ´≈´·πù·∏π]([·πÉ·∏•])?/gi;
                        return cleanedText.match(regex) || [];
                    };

                    const classifySyllables = (syllables, script) => {
                        const classified = [];
                        for (let i = 0; i < syllables.length; i++) {
                            let isGuru = false;
                            const longVowelRegex = script === 'devanagari' ? /[‡§Ü‡¶à‡§ä‡•†‡•°‡§è‡§ê‡§ì‡§î‡§æ‡•Ä‡•Ç‡•Ñ‡•£‡•á‡•à‡•ã‡•å]/ : /[ƒÅƒ´≈´·πù·∏πeaiou]/i;
                            const anunasikaRegex = script === 'devanagari' ? /[‡§Ç‡§É]/ : /[·πÉ·∏•]/i;
                            if (longVowelRegex.test(syllables[i])) isGuru = true;
                            if (anunasikaRegex.test(syllables[i])) isGuru = true;
                            if (!isGuru) {
                                const nextSyllable = syllables[i + 1] || '';
                                if (script === 'devanagari') {
                                    if (nextSyllable.includes('\u094d')) isGuru = true;
                                } else {
                                    const consonants = 'kgh·πÖcj√±·π≠·∏ç·πátdnpbmyrlv≈õ·π£sh';
                                    if (nextSyllable.length > 1 && consonants.includes(nextSyllable[0].toLowerCase()) && consonants.includes(nextSyllable[1].toLowerCase())) isGuru = true;
                                }
                            }
                            if (i === syllables.length - 1) isGuru = true;
                            classified.push({
                                syllable: syllables[i],
                                type: isGuru ? 'G' : 'L'
                            });
                        }
                        return classified;
                    };

                    function renderResults(data) {
                        const patternLength = data.pattern.length;
                        let html = `
                <div class="result-card">
                    <h3>üìä Chandkosh Analysis Results</h3>
                    <div class="syllable-display">
                        ${data.syllables.map(s => `<div class="syllable ${s.type === 'L' ? 'laghu' : 'guru'}" title="${s.type === 'L' ? 'Laghu (Light)' : 'Guru (Heavy)'}">${s.syllable}</div>`).join('')}
                    </div>
                    <div class="pattern-display">${data.pattern}</div>
                    <p style="text-align: center; color: var(--text-muted);">Total: ${patternLength} syllables identified by Chandkosh</p>
                </div>
                <div class="result-card">
                    <h3>üéØ Chandkosh Meter Identification</h3>`;

                if (data.matches.exact.length > 0) {
                    const match = data.matches.exact[0];
                    html += `
                        <div class="match-card exact">
                            <h4>‚úÖ Perfect Match Found by Chandkosh: ${match.name}</h4>
                            <p>${match.description}</p>
                            <div class="accuracy-meter">
                                <div class="accuracy-bar">
                                    <div class="accuracy-bar-inner" style="width: 100%"></div>
                                </div>
                                <span class="accuracy-text">100%</span>
                            </div>
                        </div>`;
                } else if (data.matches.fuzzy.length > 0) {
                    html += `<h4>üîç Chandkosh Found Closest Matches</h4>`;
                    data.matches.fuzzy.forEach(match => {
                        const accuracy = Math.round(((patternLength - match.distance) / patternLength) * 100);
                        html += `
                            <div class="match-card fuzzy">
                                <h4>${match.name}</h4>
                                <p>${match.description}</p>
                                <p style="color: var(--text-muted);">Mismatches: ${match.distance} syllable${match.distance > 1 ? 's' : ''}</p>
                                <div class="accuracy-meter">
                                    <div class="accuracy-bar">
                                        <div class="accuracy-bar-inner" style="width:${accuracy}%"></div>
                                    </div>
                                    <span class="accuracy-text">${accuracy}%</span>
                                </div>
                            </div>`;
                    });
                } else if (data.matches.possible.length > 0) {
                    const match = data.matches.possible[0];
                    html += `
                        <div class="match-card fuzzy">
                            <h4>üìö Chandkosh Suggests: ${match.name}</h4>
                            <p>This meter class has ${patternLength} syllables but no fixed pattern.</p>
                            <p>${match.description}</p>
                        </div>`;
                } else {
                    html += `<p style="text-align: center; color: var(--text-muted);">No known Chandas with ${patternLength} syllables found in Chandkosh database.</p>`;
                }

                html += `</div>`;
                resultsContent.innerHTML = html;
            }

            function renderMultipleResults(allResults) {
                let html = `<div class="result-card"><h3>üìù Chandkosh Analysis of Multiple Lines</h3>`;
                
                allResults.forEach(result => {
                    const patternLength = result.pattern.length;
                    html += `
                        <div style="border-left: 3px solid var(--accent-primary); padding-left: 1rem; margin-bottom: 2rem;">
                            <h4 style="color: var(--accent-primary); margin-bottom: 1rem;">Line ${result.lineNumber}</h4>
                            <div class="syllable-display">
                                ${result.syllables.map(s => `<div class="syllable ${s.type === 'L' ? 'laghu' : 'guru'}" title="${s.type === 'L' ? 'Laghu' : 'Guru'}">${s.syllable}</div>`).join('')}
                            </div>
                            <div class="pattern-display" style="font-size: 1rem; margin: 0.5rem 0;">${result.pattern}</div>`;
                    
                    if (result.matches.exact.length > 0) {
                        const match = result.matches.exact[0];
                        html += `<p><strong>‚úÖ Chandkosh Match:</strong> ${match.name}</p>`;
                    } else if (result.matches.fuzzy.length > 0) {
                        const match = result.matches.fuzzy[0];
                        const accuracy = Math.round(((patternLength - match.distance) / patternLength) * 100);
                        html += `<p><strong>üîç Chandkosh Closest:</strong> ${match.name} (${accuracy}% match)</p>`;
                    } else if (result.matches.possible.length > 0) {
                        const match = result.matches.possible[0];
                        html += `<p><strong>üìö Chandkosh Suggests:</strong> ${match.name}</p>`;
                    } else {
                        html += `<p style="color: var(--text-muted);">No meter found in Chandkosh database</p>`;
                    }
                    
                    html += `</div>`;
                });
                
                html += `</div>`;
                resultsContent.innerHTML = html;
            }

            function renderError(message) {
                resultsContainer.classList.remove('hidden');
                resultsContent.innerHTML = `
                    <div class="result-card" style="border-left: 4px solid var(--accent-danger); background: rgba(252, 129, 129, 0.1);">
                        <h3 style="color: var(--accent-danger);">‚ö†Ô∏è Chandkosh Error</h3>
                        <p>${message}</p>
                    </div>`;
            }
        });
    </script>
</body>

</html>